# Основы Операционных Систем (Windows, Linux)

Хотя .NET абстрагирует многие детали ОС, для Senior-разработчика важно понимать базовые концепции, чтобы диагностировать проблемы с производительностью, памятью и взаимодействием с системой.

## 1. Процессы и Потоки

- **Процесс (Process)**
  - **Что это?** Изолированный экземпляр запущенной программы.
  - **Что имеет?**
    - **Собственное виртуальное адресное пространство**: Один процесс не может напрямую получить доступ к памяти другого процесса. Это основа безопасности и стабильности ОС.
    - **Собственные ресурсы**: Дескрипторы файлов, сетевые подключения и т.д.
  - **В .NET**: `System.Diagnostics.Process` класс позволяет запускать процессы и взаимодействовать с ними.

- **Поток (Thread)**
  - **Что это?** Наименьшая единица выполнения кода, которой ОС может управлять.
  - **Что имеет?**
    - **Собственный стек**: Для хранения локальных переменных и адресов возврата.
    - **Собственные регистры CPU**: Включая счетчик команд (instruction pointer).
  - **Что разделяет?** Потоки **внутри одного процесса** разделяют **общее адресное пространство** (кучу, глобальные переменные). Это делает взаимодействие между ними быстрым, но и опасным (требуется синхронизация).
  - **В .NET**: `System.Threading.Thread`, `ThreadPool`, `Task` — все это абстракции над потоками ОС.

- **Контекстное переключение (Context Switching)**
  - **Что это?** Процесс сохранения состояния одного потока (или процесса) и восстановления состояния другого, чтобы передать ему управление CPU.
  - **Почему это важно?** Это дорогостоящая операция. Частое переключение контекста может снизить производительность. `async/await` в .NET помогает избежать блокировки потоков и ненужных переключений контекста при операциях ввода-вывода.

## 2. Управление памятью

- **Виртуальная память**
  - **Что это?** Абстракция, которую ОС предоставляет каждому процессу. Каждый процесс "думает", что у него есть доступ ко всему диапазону адресов (например, 2^64 на 64-битной системе), хотя на самом деле физической оперативной памяти (RAM) может быть гораздо меньше.
  - **Как работает?** ОС и CPU вместе отображают (map) страницы виртуальной памяти на страницы физической памяти.
  - **Файл подкачки (Page File / Swap)**: Если физической памяти не хватает, ОС может выгружать неиспользуемые страницы памяти на жесткий диск.

- **Стек (Stack)**
  - **Что это?** Область памяти для каждого потока.
  - **Назначение**: Хранение локальных переменных, параметров методов, адресов возврата.
  - **Свойства**: Быстрый доступ, управляется автоматически (LIFO - Last In, First Out), размер ограничен. Переполнение стека (`StackOverflowException`) происходит при слишком глубокой рекурсии.

- **Куча (Heap)**
  - **Что это?** Область памяти для всего процесса.
  - **Назначение**: Хранение объектов, время жизни которых не связано с вызовом одного метода (экземпляры классов).
  - **Свойства**: Медленный доступ (по сравнению со стеком), размер ограничен только размером виртуального адресного пространства, требует управления (в .NET это делает сборщик мусора - GC).

## 3. Файловые системы
- **Что это?** Способ организации и хранения файлов на диске.
- **Windows**: **NTFS**.
  - **Особенности**: Поддержка прав доступа (ACLs), шифрования (EFS), сжатия, журналирования (для восстановления после сбоев). Пути не чувствительны к регистру (`file.txt` и `FILE.TXT` - это один и тот же файл).
- **Linux**: **ext4** (стандарт де-факто), XFS, Btrfs.
  - **Особенности**: Все является файлом (устройства, сокеты и т.д. представлены в файловой системе), иерархическая структура, начинающаяся с корня (`/`). Пути чувствительны к регистру (`file.txt` и `FILE.TXT` - это разные файлы).
- **Различия для разработчика**:
  - **Разделители путей**: `\` в Windows, `/` в Linux. В .NET используйте `Path.Combine()` или `Path.DirectorySeparatorChar`, чтобы код был кроссплатформенным.
  - **Права доступа**: Модели прав доступа отличаются.
  - **Конец строки**: `\r\n` (CRLF) в Windows, `\n` (LF) в Linux. Git может автоматически конвертировать их.

## 4. Системные вызовы (System Calls)
- **Что это?** Механизм, с помощью которого пользовательская программа (user mode) запрашивает у ядра ОС (kernel mode) выполнение какой-либо операции, которую она не может выполнить сама (например, работа с файлами, сетью).
- **Как .NET это использует?** Все операции ввода-вывода в .NET (`File.Read`, `HttpClient.GetAsync`) в конечном итоге преобразуются в системные вызовы к соответствующей ОС. Понимание этого помогает осознать, почему I/O-операции являются асинхронными по своей природе. 