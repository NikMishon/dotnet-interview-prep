# DDD (Domain-Driven Design) - Предметно-ориентированное проектирование

DDD — это подход к разработке ПО, который фокусируется на **предметной области** (бизнес-домене). Главная цель — создание модели, которая точно отражает бизнес-процессы и используется как основа для кода.

## Ключевые концепции

### 1. Ubiquitous Language (Единый язык)
- **Что это**: Общий, строгий и однозначный язык, который используется всеми участниками проекта: разработчиками, экспертами предметной области (domain experts), менеджерами, тестировщиками.
- **Цель**: Устранить недопонимание и неверные интерпретации. Если в бизнесе говорят "Клиент размещает Заказ", то в коде должны быть классы `Client` и `Order` и метод `PlaceOrder`.
- **Как создается**: В постоянном диалоге между командой разработки и экспертами домена.

### 2. Bounded Context (Ограниченный контекст)
- **Что это**: Явная граница, внутри которой существует определенная доменная модель и применяется Единый язык. Одна и та же концепция может иметь разное значение и поведение в разных контекстах.
- **Пример**: Понятие "Товар" (Product).
  - В **контексте "Каталог"**: Товар имеет цену, описание, изображение.
  - В **контексте "Склад"**: Товар имеет вес, габариты, количество на остатке.
  - В **контексте "Доставка"**: Товар имеет статус отправки.
- **Цель**: Избежать создания одной гигантской, переусложненной модели на все случаи жизни. Каждый контекст имеет свою, более простую и сфокусированную модель.
- **Context Map (Карта контекстов)**: Диаграмма, которая показывает, как разные ограниченные контексты взаимодействуют друг с другом (например, через антикоррупционный слой, общий модуль и т.д.).

## Строительные блоки (Building Blocks)

Это паттерны, которые используются для построения доменной модели внутри ограниченного контекста.

### 1. Entity (Сущность)
- **Что это**: Объект, который обладает **уникальной идентичностью** (ID) и жизненным циклом. Его не определяют атрибуты, а определяет его ID.
- **Пример**: `Пользователь` (даже если два пользователя имеют одинаковое имя, их ID уникальны), `Заказ`, `Автомобиль`.
- **Характеристики**:
  - Имеет глобальный идентификатор (`Id`).
  - Изменяемый (mutable).
  - Сравнение происходит по `Id`.

### 2. Value Object (Объект-значение)
- **Что это**: Объект, который описывает какую-то характеристику и **не имеет уникальной идентичности**. Его определяют значения его атрибутов.
- **Пример**: `Адрес` (два адреса с одинаковой улицей и домом идентичны), `Цвет`, `Диапазон дат`, `Деньги` (сумма + валюта).
- **Характеристики**:
  - Неизменяемый (immutable).
  - Не имеет `Id`.
  - Сравнение происходит по всем полям.

### 3. Aggregate (Агрегат)
- **Что это**: Кластер из связанных сущностей и объектов-значений, который рассматривается как единое целое.
- **Aggregate Root (Корень агрегата)**: Одна из сущностей внутри агрегата, которая является его "главной". Это единственная точка входа для всех изменений внутри агрегата.
- **Правила**:
  1. Корень агрегата — это глобально идентифицируемый объект (Entity).
  2. Объекты внутри агрегата могут ссылаться друг на друга.
  3. **Внешние объекты могут ссылаться только на корень агрегата**.
  4. Все операции изменения данных внутри агрегата должны проходить через корень. Это позволяет корню контролировать целостность (инварианты) всего агрегата.
- **Пример**: Агрегат "Заказ".
  - `Order` (Заказ) — это корень агрегата.
  - `OrderItem` (Позиция заказа) — сущность внутри агрегата.
  - `Address` (Адрес доставки) — объект-значение внутри агрегата.
  - Чтобы добавить позицию в заказ, мы вызываем метод `order.AddItem()`, а не создаем `OrderItem` напрямую.

### 4. Repository (Репозиторий)
- **Что это**: Паттерн, который имитирует коллекцию объектов в памяти. Он инкапсулирует логику доступа к данным (БД, файлы, API).
- **Цель**: Отделить доменную модель от инфраструктуры хранения данных. Бизнес-логика работает с репозиторием и не знает, где на самом деле хранятся данные — в SQL, MongoDB или где-то еще.
- **Правила**:
  - Определяется для каждого агрегата (`IOrderRepository`).
  - Методы репозитория оперируют терминами доменной модели (`GetById(orderId)`, `Save(order)`).

### 5. Domain Service (Доменный сервис)
- **Что это**: Операция или бизнес-логика, которая не принадлежит естественным образом ни одной сущности или объекту-значению.
- **Когда использовать**: Когда логика затрагивает несколько агрегатов или является сложным вычислением.
- **Пример**: Перевод денег между двумя счетами. Эта операция не является ответственностью одного счета, она затрагивает два. Поэтому создается `MoneyTransferService`, который координирует оба объекта.
- **Характеристики**: Обычно не имеет состояния (stateless).

### 6. Domain Event (Доменное событие)
- **Что это**: Объект, который описывает что-то значимое, что произошло в домене в прошлом.
- **Пример**: `OrderPlaced` (Заказ размещен), `UserRegistered` (Пользователь зарегистрирован).
- **Цель**: Обеспечить слабую связность между разными частями системы. Когда агрегат "Заказ" публикует событие `OrderPlaced`, другие части системы (например, модуль уведомлений или модуль склада) могут на него отреагировать, не будучи напрямую связанными с модулем заказов. 