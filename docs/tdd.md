# TDD (Test-Driven Development) - Разработка через тестирование

TDD — это техника разработки программного обеспечения, в которой цикл разработки строится на повторении коротких циклов "сначала тест, потом код".

## 1. Цикл TDD: "Красный -> Зеленый -> Рефакторинг"

Это сердце TDD. Весь процесс разработки делится на очень маленькие шаги.

1.  **Красный (Red)** - Написать падающий тест.
    - **Задача**: Четко сформулировать требования к новой функциональности в виде автоматизированного теста.
    - Вы пишете тест для кода, которого еще не существует. Естественно, этот тест не скомпилируется или упадет. Это "красная" фаза.
    - **Пример**:
      ```csharp
      [Fact]
      public void Add_EmptyString_ReturnsZero()
      {
          var calculator = new StringCalculator();
          var result = calculator.Add("");
          Assert.Equal(0, result);
      }
      ```
      *Этот тест упадет, потому что класса `StringCalculator` и метода `Add` еще нет.*

2.  **Зеленый (Green)** - Написать минимальный код для прохождения теста.
    - **Задача**: Заставить тест пройти. На этом шаге не нужно думать об элегантности или оптимальности решения. Цель — написать **самый простой, возможно даже "глупый" код**, который удовлетворит тест.
    - **Пример**:
      ```csharp
      public class StringCalculator
      {
          public int Add(string numbers)
          {
              return 0; // Самый простой код, чтобы тест прошел
          }
      }
      ```
      *Теперь первый тест проходит. Это "зеленая" фаза.*

3.  **Рефакторинг (Refactor)** - Улучшить код.
    - **Задача**: Теперь, когда у вас есть работающий код, защищенный тестом, вы можете безбоязненно улучшать его структуру. Удалить дублирование, повысить читаемость, улучшить дизайн.
    - Важно: на этом этапе вы не добавляете новую функциональность, а только улучшаете существующий код. Тесты должны оставаться "зелеными".
    - **Пример**: На первом шаге рефакторинг может и не понадобиться. Но после добавления новых тестов (например, для одного или двух чисел) код может выглядеть так:
      ```csharp
      public int Add(string numbers)
      {
          if (string.IsNullOrEmpty(numbers))
              return 0;
          
          return int.Parse(numbers);
      }
      // Этот код можно улучшить, но пока он проходит тесты, это нормально.
      ```

**И затем цикл повторяется для следующего маленького шага функциональности.** (Например, следующий тест `Add_SingleNumber_ReturnsSameNumber`).

## 2. Преимущества TDD
- **Улучшение дизайна кода**: Код, который легко тестировать, по своей природе является слабосвязанным (loosely coupled) и следует принципу единственной ответственности. TDD "заставляет" вас думать о дизайне до написания кода.
- **Живая документация**: Набор юнит-тестов — это исполняемая спецификация. Любой разработчик может посмотреть на тесты, чтобы понять, как система должна себя вести.
- **Уверенность в рефакторинге**: Когда у вас есть полный набор тестов, вы можете проводить рефакторинг и вносить изменения с уверенностью, что ничего не сломали. Если тесты "зеленые" — система работает.
- **Полное покрытие тестами**: По определению, ни одна строчка кода не пишется без предварительно написанного теста. Это гарантирует высокое покрытие кода тестами.
- **Быстрая обратная связь**: TDD позволяет обнаруживать ошибки на самой ранней стадии, когда их исправление наиболее дешево.

## 3. TDD vs. Традиционное тестирование
В традиционном подходе тесты пишутся **после** кода. Это часто приводит к тому, что:
- Пишутся тесты, которые просто подтверждают, что код работает так, как он написан, а не так, как он **должен** работать.
- Написание тестов откладывается "на потом" и в итоге не делается вовсе.
- Код получается сложным для тестирования, так как он не проектировался с мыслью о тестируемости.

TDD меняет этот процесс, делая тесты движущей силой разработки, а не второстепенной задачей.

## 4. Что важно помнить
- **TDD — это не про тестирование, а про дизайн**: Основная цель TDD — не в написании тестов как таковых, а в создании хорошо спроектированного, поддерживаемого кода.
- **Тестировать нужно поведение, а не реализацию**: Тест не должен зависеть от внутренних деталей класса. Он должен проверять "публичный контракт".
- **Маленькие шаги**: Цикл Red-Green-Refactor должен быть очень коротким (минуты, а не часы). 